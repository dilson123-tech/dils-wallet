name: notify-canary (workflow_run)

on:
  workflow_run:
    # IMPORTANTE: filtra só workflows "de verdade" pra NÃO virar loop infinito
    workflows: ["CI", "smoke-pix", "health-prod"]
    types: [completed]

jobs:
  echo:
    # roda só se o workflow que disparou veio do main
    if: ${{ github.event.workflow_run.head_branch == 'main' }}
    runs-on: ubuntu-latest
    steps:
      - name: Print workflow_run payload (essentials)
        run: |
          echo "TRIGGERED BY:  ${{ github.event.workflow_run.name }}"
          echo "STATUS:        ${{ github.event.workflow_run.status }}"
          echo "CONCLUSION:    ${{ github.event.workflow_run.conclusion }}"
          echo "HEAD_BRANCH:   ${{ github.event.workflow_run.head_branch }}"
          echo "HTML_URL:      ${{ github.event.workflow_run.html_url }}"
