name: Slack Webhook Test
on:
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Send test to Slack (with debug)
        env:
          WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          set -euo pipefail
          TS="$(date -u +'%Y-%m-%dT%H:%M:%SZ')"
          MSG=$(jq -n --arg t "âœ… Slack webhook OK via GitHub Actions @ $TS" '{text:$t}')
          CODE=$(curl -s -o /tmp/slack_resp.txt -w "%{http_code}" -X POST -H 'Content-type: application/json' \
            --data "$MSG" "$WEBHOOK")
          echo "HTTP=$CODE"
          echo "BODY=$(cat /tmp/slack_resp.txt || true)"
          test "$CODE" = "200"
