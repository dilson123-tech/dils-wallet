name: Smoke â€” Health e Auth check

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  smoke:
    runs-on: ubuntu-latest
    env:
      BASE_URL: ${{ secrets.SMOKE_BASE_URL }}
      HEALTH_TOKEN: ${{ secrets.HEALTH_TOKEN }}
      BEARER_TOKEN: ${{ secrets.BEARER_TOKEN }}
    steps:
      - name: Health check
        run: |
          echo ">> Checking /healthz"
          curl -fsS -H "X-Health-Token: ${HEALTH_TOKEN}" "${BASE_URL}/healthz" | jq .
      - name: Auth check
        run: |
          echo ">> Checking /api/v1/transactions/balance"
          curl -fsS -H "Authorization: Bearer ${BEARER_TOKEN}" "${BASE_URL}/api/v1/transactions/balance" | jq .
